<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wishlist Saya - SmartFarm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/public_style.css" />
  </head>
  <style>
    /* =================================================================== */
    /* [UPGRADE] WISHLIST PAGE STYLES */
    /* =================================================================== */

    .wishlist-header .wishlist-title {
      font-weight: 700;
      font-size: 2.5rem;
      color: var(--dark-text);
    }

    .wishlist-header .wishlist-subtitle {
      font-size: 1.1rem;
      color: var(--light-text);
      max-width: 500px;
      margin: 10px auto 0;
    }

    /* KARTU PRODUK KHUSUS WISHLIST */
    .wishlist-card {
      background-color: var(--white);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: none; /* Awalnya tidak ada shadow */
    }

    .wishlist-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07); /* Shadow muncul saat di-hover */
    }

    /* GAMBAR LEBIH BESAR & TINGGI */
    .wishlist-card .product-image-wrapper {
      position: relative;
      overflow: hidden;
      height: 300px; /* <--- UKURAN GAMBAR DIPERBESAR DI SINI */
    }

    .wishlist-card .product-image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .wishlist-card:hover .product-image-wrapper img {
      transform: scale(1.05);
    }

    /* Info produk di bawahnya tetap menggunakan style yang sama */
    .wishlist-card .product-info {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    /* Tombol hapus disesuaikan */
    .wishlist-card .product-actions .action-btn.remove-from-wishlist {
      background-color: rgba(220, 53, 69, 0.8); /* Warna merah transparan */
      color: white;
      backdrop-filter: blur(2px);
    }

    .wishlist-card .product-actions .action-btn.remove-from-wishlist:hover {
      background-color: #dc3545; /* Merah solid pas hover */
      transform: scale(1.1);
    }

    /* RESPONSIVE ADJUSTMENTS */
    @media (max-width: 992px) {
      .wishlist-header .wishlist-title {
        font-size: 2rem;
      }

      .wishlist-header .wishlist-subtitle {
        font-size: 1rem;
      }

      .wishlist-card .product-image-wrapper {
        height: 250px;
      }
    }

    @media (max-width: 768px) {
      .wishlist-header .wishlist-title {
        font-size: 1.8rem;
      }

      .wishlist-header .wishlist-subtitle {
        font-size: 0.95rem;
        max-width: 400px;
      }

      .wishlist-card .product-image-wrapper {
        height: 220px;
      }

      .product-info {
        padding: 1rem;
      }

      .product-title {
        font-size: 1rem;
      }

      .product-price {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 576px) {
      .wishlist-header .wishlist-title {
        font-size: 1.5rem;
      }

      .wishlist-header .wishlist-subtitle {
        font-size: 0.9rem;
        max-width: 300px;
      }

      .wishlist-card .product-image-wrapper {
        height: 200px;
      }

      .product-info {
        padding: 0.8rem;
      }

      .product-category {
        font-size: 0.8rem;
      }

      .product-title {
        font-size: 0.9rem;
      }

      .product-price {
        font-size: 0.85rem;
      }

      .btn-add-cart-icon {
        padding: 0.4rem;
      }
    }

    /* Empty wishlist message styling */
    .empty-wishlist-icon {
      color: #6c757d;
      margin-bottom: 1rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    .empty-wishlist-title {
      color: #495057;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .empty-wishlist-text {
      color: #6c757d;
      margin-bottom: 1.5rem;
    }
  </style>
  <body>
    <div id="preloader"><div class="spinner"></div></div>
    <div id="header-placeholder"></div>

    <main class="container my-5">
      <div class="wishlist-header text-center mb-5">
        <h1 class="wishlist-title">Produk Favorit Pilihanmu</h1>
        <p class="wishlist-subtitle">
          Ini adalah daftar produk yang kamu suka. Segera checkout sebelum
          kehabisan!
        </p>
      </div>

      <div
        class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4"
        id="wishlist-container"
      >
        <div class="col">
          <div class="product-card-offer skeleton" style="height: 400px"></div>
        </div>
        <div class="col">
          <div class="product-card-offer skeleton" style="height: 400px"></div>
        </div>
      </div>

      <div
        id="empty-wishlist-message"
        class="text-center p-5"
        style="display: none"
      >
        <div class="empty-wishlist-icon">
          <i class="far fa-heart fa-4x"></i>
        </div>
        <h3 class="empty-wishlist-title">
          Yahh, wishlist-mu masih kosong nih!
        </h3>
        <p class="empty-wishlist-text">
          Ayo, cari produk favoritmu dan tambahkan ke wishlist dengan menekan
          tombol hati ❤️
        </p>
        <a href="products.html" class="btn btn-smartfarm-primary mt-2"
          >Cari Produk Sekarang</a
        >
      </div>
    </main>

    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/public_script.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Cek dulu apakah user sudah login, kalau belum, tendang ke halaman login!
        if (!isAuthenticated()) {
          showNotification("Masuk dulu untuk melihat wishlist!", "warning");
          setTimeout(() => {
            window.location.href = "login.html";
          }, 1500);
          return;
        }

        // Pastikan fungsi getSampleProducts dari public_script.js sudah ada
        if (typeof getSampleProducts !== "function") {
          console.error("FUNGSI getSampleProducts() TIDAK DITEMUKAN!");
          document.getElementById("wishlist-container").innerHTML =
            '<p class="text-center text-danger">Gagal memuat data produk.</p>';
          return;
        }

        const allProducts = getSampleProducts();
        const wishlistContainer = document.getElementById("wishlist-container");
        const emptyMessage = document.getElementById("empty-wishlist-message");

        function renderWishlist() {
          const wishlistIds =
            JSON.parse(localStorage.getItem("smartfarm_wishlist")) || [];
          wishlistContainer.innerHTML = ""; // Kosongkan dulu

          if (wishlistIds.length === 0) {
            emptyMessage.style.display = "block";
            return;
          }

          emptyMessage.style.display = "none";

          // Filter produk dari 'database' utama berdasarkan ID yang ada di wishlist
          const wishlistedProducts = allProducts.filter((p) =>
            wishlistIds.includes(String(p.id))
          );

          wishlistedProducts.forEach((product) => {
            // Kita pakai template dari product-card-offer biar konsisten
            const cardHTML = `
                    <div class="col d-flex">
                        <div class="product-card-offer h-100">
                            <div class="product-image-wrapper">
                                <a href="product_detail.html?id=${product.id}">
                                    <img src="${product.image}" alt="${
              product.name
            }" loading="lazy"/>
                                </a>
                                ${
                                  product.badge
                                    ? `<div class="product-badge ${product.badge.class}">${product.badge.text}</div>`
                                    : ""
                                }
                                <div class="product-actions">
                                    <button class="action-btn remove-from-wishlist" title="Hapus dari Wishlist" data-product-id="${
                                      product.id
                                    }" data-product-name="${product.name}">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="product-info">
                                <p class="product-category">${
                                  product.category
                                }</p>
                                <h3 class="product-title"><a href="product_detail.html?id=${
                                  product.id
                                }">${product.name}</a></h3>
                                <div class="product-price-action mt-auto">
                                    <p class="product-price">
                                        ${
                                          product.originalPrice
                                            ? `<span class="price-original">Rp ${product.originalPrice.toLocaleString(
                                                "id-ID"
                                              )}</span>`
                                            : ""
                                        }
                                        Rp ${product.price.toLocaleString(
                                          "id-ID"
                                        )}
                                    </p>
                                    <button class="btn-add-cart-icon" title="Tambah ke Keranjang" 
                                        data-product-id="${product.id}" 
                                        data-product-name="${product.name}" 
                                        data-product-price="${product.price}" 
                                        data-product-image="${product.image}">
                                        <i class="fas fa-shopping-cart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            wishlistContainer.innerHTML += cardHTML;
          });
        }

        // Event listener untuk HAPUS dari wishlist (lebih efisien)
        wishlistContainer.addEventListener("click", function (e) {
          const removeBtn = e.target.closest(".remove-from-wishlist");
          if (removeBtn) {
            const productId = removeBtn.dataset.productId;
            const productName = removeBtn.dataset.productName;

            let wishlist =
              JSON.parse(localStorage.getItem("smartfarm_wishlist")) || [];
            const productIndex = wishlist.indexOf(productId);

            if (productIndex > -1) {
              wishlist.splice(productIndex, 1);
              localStorage.setItem(
                "smartfarm_wishlist",
                JSON.stringify(wishlist)
              );
              showNotification(
                `${productName} dihapus dari wishlist`,
                "success"
              );
              renderWishlist(); // Tampilkan ulang wishlist yang sudah di-update
            }
          }
        });

        // Panggil fungsi untuk pertama kali
        renderWishlist();
      });
    </script>
  </body>
</html>
