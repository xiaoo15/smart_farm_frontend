<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semua Produk - SmartFarm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/public_style.css" />
  </head>
  <body>
    <div id="preloader">
      <div class="spinner"></div>
    </div>

    <div id="header-placeholder"></div>

    <main class="container my-5">
      <div class="row">
        <div class="col-lg-3">
          <div class="filter-sidebar">
            <h5 class="filter-title">Filter Produk</h5>
            <div class="filter-group">
              <h6>Kategori</h6>
              <div class="form-check">
                <input
                  class="form-check-input category-filter"
                  type="checkbox"
                  name="kategori"
                  id="kat_kit"
                  value="kit"
                /><label class="form-check-label" for="kat_kit"
                  >Hidroponik Kit</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input category-filter"
                  type="checkbox"
                  name="kategori"
                  id="kat_bibit"
                  value="bibit"
                /><label class="form-check-label" for="kat_bibit"
                  >Bibit & Benih</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input category-filter"
                  type="checkbox"
                  name="kategori"
                  id="kat_hias"
                  value="hias"
                /><label class="form-check-label" for="kat_hias"
                  >Tanaman Hias</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input category-filter"
                  type="checkbox"
                  name="kategori"
                  id="kat_nutrisi"
                  value="nutrisi"
                /><label class="form-check-label" for="kat_nutrisi"
                  >Nutrisi</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input category-filter"
                  type="checkbox"
                  name="kategori"
                  id="kat_media"
                  value="media"
                /><label class="form-check-label" for="kat_media"
                  >Media Tanam</label
                >
              </div>
            </div>
            <div class="filter-group">
              <h6>Rentang Harga</h6>
              <label for="hargaRange" class="form-label" id="hargaLabel"
                >Maks: Rp 500.000</label
              >
              <input
                type="range"
                class="form-range"
                min="0"
                max="500000"
                step="10000"
                id="hargaRange"
                value="500000"
              />
            </div>
          </div>
        </div>

        <div class="col-lg-9">
          <div
            class="search-header d-flex flex-column flex-md-row gap-3 align-items-md-center mb-4"
          >
            <div class="input-group">
              <span class="search-icon"><i class="fas fa-search"></i></span
              ><input
                type="text"
                class="form-control"
                placeholder="Cari HydroKit, bibit, atau nutrisi..."
                id="searchInput"
              />
            </div>
            <div class="dropdown">
              <button
                class="btn btn-sort dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                id="sortButton"
              >
                Urutkan: Terbaru
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a
                    class="dropdown-item sort-option"
                    href="#"
                    data-sort="terbaru"
                    >Terbaru</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item sort-option"
                    href="#"
                    data-sort="harga-asc"
                    >Harga: Terendah ke Tertinggi</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item sort-option"
                    href="#"
                    data-sort="harga-desc"
                    >Harga: Tertinggi ke Terendah</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <div
            class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4"
            id="product-list"
          ></div>
        </div>
      </div>
    </main>

    <div id="footer-placeholder"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/public_script.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ===================================================================
        // DATA PRODUK (PUSAT DATA)
        // ===================================================================
        const allProducts = [
          // --- KATEGORI: HIDROPONIK KIT ---
          {
            id: 1,
            name: "HydroKit Mini Starter",
            category: "kit",
            price: 185000,
            originalPrice: 225000,
            image:
              "https://i.pinimg.com/736x/3f/bd/42/3fbd42c0b1283820276dbf7661e32ee1.jpg",
            rating: 4.8,
            sold: "3.2k",
            date: "2024-08-10",
            badge: { text: "DISKON", class: "badge-sale" },
            description:
              "Paket lengkap untuk pemula yang ingin mencoba hidroponik. Mudah dirakit dan tidak memakan tempat, cocok untuk menanam sayuran daun di balkon atau halaman rumah. Semua yang Anda butuhkan untuk memulai panen pertama Anda ada di sini.",
            specs: {
              "Jumlah Lubang": "8",
              "Ukuran Pipa": "2.5 inch",
              "Kapasitas Air": "15 Liter",
              "Isi Paket":
                "Pipa, Pompa, Netpot, Rockwool, 2 Jenis Benih, Nutrisi AB Mix 250ml",
            },
          },
          {
            id: 7,
            name: "HydroTower Vertical Garden",
            category: "kit",
            price: 750000,
            originalPrice: null,
            image:
              "https://image.made-in-china.com/318f0j00ItwUmAoEnHki/hydro-tower-mp4.webp",
            rating: 5,
            sold: "890",
            date: "2024-07-22",
            badge: { text: "PRODUK BARU", class: "badge-new" },
            description:
              "Solusi berkebun di lahan terbatas. Sistem hidroponik vertikal yang efisien dan modern, mampu menampung hingga 20 tanaman. Desain elegan yang juga berfungsi sebagai dekorasi.",
            specs: {
              "Jumlah Lubang": "20",
              Sistem: "NFT (Nutrient Film Technique)",
              Tinggi: "1.5 Meter",
              "Isi Paket":
                "Tower, Pompa, Netpot, Rockwool, Nutrisi AB Mix 500ml, Timer",
            },
          },
          {
            id: 8,
            name: "Dutch Bucket System (5 Pot)",
            category: "kit",
            price: 450000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/d5/3a/77/d53a7742f48e45ed66b890a5e79a8e74.jpg",
            rating: 4.5,
            sold: "1.1k",
            date: "2024-06-15",
            badge: { text: "BEST SELLER", class: "badge-bestseller" },
            description:
              "Sistem hidroponik yang ideal untuk tanaman buah seperti tomat, paprika, dan mentimun. Setiap pot memiliki sistem irigasi tetes individu untuk nutrisi yang optimal.",
            specs: {
              "Jumlah Pot": "5",
              "Kapasitas Pot": "10 Liter",
              "Media Tanam": "Perlite & Vermiculite (termasuk)",
              "Isi Paket":
                "5 Bucket, Pipa Sirkulasi, Pompa, Selang, Nutrisi Buah 500ml",
            },
          },
          {
            id: 15,
            name: "Window Farm Kit",
            category: "kit",
            price: 250000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/62/01/a3/6201a3ff90d61d7db5659f92bede2f75.jpg",
            rating: 4.2,
            sold: "450",
            date: "2024-05-01",
            badge: null,
            description:
              "Manfaatkan jendela rumahmu untuk menanam sayuran segar atau herbal dengan kit hidroponik gantung yang praktis ini. Menggunakan botol daur ulang sebagai wadah tanam.",
            specs: {
              "Jumlah Lubang": "4",
              Sistem: "Wick System (Sumbu)",
              "Cocok Untuk": "Herbal (Basil, Mint), Selada",
              "Isi Paket":
                "Rangka Gantung, Pompa Mini, Sumbu, Netpot, Rockwool, Benih Herbal",
            },
          },
          // --- KATEGORI: TANAMAN HIAS ---
          {
            id: 2,
            name: "Caladium Red Star",
            category: "hias",
            price: 75000,
            originalPrice: null,
            image:
              "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSQpxICck1kyAHXchQT7oteq1cY-ODKGYTlQA&s",
            rating: 4.5,
            sold: "230",
            date: "2024-08-01",
            badge: { text: "PRODUK BARU", class: "badge-new" },
            description:
              "Tanaman hias dengan warna merah menyala yang eksotis. Daunnya yang berbentuk hati memberikan sentuhan tropis yang mewah di sudut ruangan Anda. Perawatan mudah dan tidak memerlukan banyak sinar matahari langsung.",
            specs: {
              "Tinggi Tanaman": "20-30 cm",
              "Ukuran Pot": "Diameter 15 cm",
              "Media Tanam": "Sekam Bakar, Cocopeat",
              "Kebutuhan Sinar": "Rendah - Sedang",
            },
          },
          {
            id: 6,
            name: "Monstera Deliciosa",
            category: "hias",
            price: 125000,
            originalPrice: null,
            image:
              "https://www.studioplant.com/media/catalog/product/cache/5f475ed5c56894ef7a51968da51e8dc7/m/o/monstera_-_4.jpg",
            rating: 5,
            sold: "185",
            date: "2024-08-05",
            badge: null,
            description:
              "Tanaman hias ikonik dengan daun terbelah yang unik. Memberikan kesan tropis dan modern pada interior. Semakin dewasa, belahan daunnya akan semakin banyak dan indah.",
            specs: {
              "Tinggi Tanaman": "30-40 cm",
              "Ukuran Pot": "Diameter 18 cm",
              "Media Tanam": "Tanah Subur, Humus",
              "Kebutuhan Sinar": "Sedang, tidak langsung",
            },
          },
          {
            id: 9,
            name: "Sansevieria Trifasciata",
            category: "hias",
            price: 60000,
            originalPrice: 80000,
            image:
              "https://i.pinimg.com/1200x/a1/c9/2b/a1c92bd7dc40fdf544efa989849b9cfb.jpg",
            rating: 4.7,
            sold: "950",
            date: "2024-07-18",
            badge: { text: "DISKON", class: "badge-sale" },
            description:
              "Dikenal sebagai 'Lidah Mertua', tanaman ini sangat kuat dan mampu membersihkan udara dalam ruangan dari polutan. Sangat cocok untuk pemula karena perawatannya sangat minim.",
            specs: {
              "Tinggi Tanaman": "25-35 cm",
              "Ukuran Pot": "Diameter 15 cm",
              "Media Tanam": "Sekulen & Kaktus Mix",
              "Kebutuhan Sinar": "Sangat Toleran (Rendah - Terang)",
            },
          },
          {
            id: 10,
            name: "Alocasia Black Velvet",
            category: "hias",
            price: 150000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/736x/ca/29/f4/ca29f44fd8e19ee12b87bdb7803cdc39.jpg",
            rating: 4.9,
            sold: "310",
            date: "2024-08-12",
            badge: { text: "STOK TERBATAS", class: "badge-limited" },
            description:
              "Tanaman premium dengan daun hitam beludru dan urat silver yang mewah. Menjadi pusat perhatian di koleksi tanaman hias Anda. Membutuhkan kelembapan yang cukup.",
            specs: {
              "Tinggi Tanaman": "15-25 cm",
              "Ukuran Pot": "Diameter 12 cm",
              "Media Tanam": "Aroid Mix (Cocochip, Perlite)",
              "Kebutuhan Sinar": "Terang, tidak langsung",
            },
          },
          // --- KATEGORI: BIBIT & BENIH ---
          {
            id: 3,
            name: "Bibit Selada Romaine (Hydro)",
            category: "bibit",
            price: 25000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/74/e7/8c/74e78cb0708839f8dbfe4ceded346702.jpg",
            rating: 5,
            sold: "8k+",
            date: "2024-07-25",
            badge: { text: "PILIHAN", class: "badge-limited" },
            description:
              "Bibit selada romaine unggulan yang sudah diadaptasi khusus untuk sistem hidroponik. Memiliki tingkat germinasi tinggi, cepat tumbuh, dan tekstur daun yang renyah. Panen dalam 30-40 hari setelah semai.",
            specs: {
              "Isi per Paket": "± 200 biji",
              Germinasi: "85% - 95%",
              "Rekomendasi pH": "5.5 - 6.5",
              "Rekomendasi PPM": "560 - 840",
            },
          },
          {
            id: 11,
            name: "Benih Kangkung Bangkok",
            category: "bibit",
            price: 12000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/736x/a3/88/be/a388bea9abc16ac0277917949f295a72.jpg",
            rating: 4.8,
            sold: "12k+",
            date: "2024-03-10",
            badge: { text: "BEST SELLER", class: "badge-bestseller" },
            description:
              "Benih kangkung varietas Bangkok, mudah tumbuh, dan bisa dipanen dalam waktu singkat (20-30 hari). Cocok untuk ditanam di sistem hidroponik maupun konvensional.",
            specs: {
              "Isi per Paket": "± 500 biji",
              Germinasi: "> 90%",
              "Rekomendasi pH": "5.5 - 7.0",
              "Rekomendasi PPM": "700 - 1400",
            },
          },
          {
            id: 12,
            name: "Benih Tomat Cherry Super",
            category: "bibit",
            price: 30000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/0c/cc/58/0ccc583baa2eb7979735c2574bb653ed.jpg",
            rating: 4.6,
            sold: "2.5k",
            date: "2024-06-20",
            badge: null,
            description:
              "Hasilkan tomat cherry yang manis dan melimpah langsung dari kebun hidroponik Anda. Tahan terhadap penyakit dan cuaca panas.",
            specs: {
              "Isi per Paket": "± 30 biji",
              Germinasi: "80% - 90%",
              "Potensi Hasil": "3-5 kg per tanaman",
              "Masa Panen": "~90 hari setelah tanam",
            },
          },
          {
            id: 18,
            name: "Bibit Strawberry California",
            category: "bibit",
            price: 45000,
            originalPrice: null,
            image:
              "https://down-id.img.susercontent.com/file/8f4a387cbbb4e5af5f04b513801ee06d@resize_w900_nl.webp",
            rating: 4.9,
            sold: "5.2k",
            date: "2024-08-08",
            badge: { text: "PRODUK BARU", class: "badge-new" },
            description:
              "Bibit unggul strawberry California yang sudah beradaptasi untuk ditanam di iklim tropis. Menghasilkan buah yang besar dan manis. Dikirim dalam bentuk bibit hidup siap tanam.",
            specs: {
              Tipe: "Bibit hidup (runner)",
              Jumlah: "1 bibit",
              "Rekomendasi Sistem": "NFT, Rak Tetes",
              "Rekomendasi PPM": "840 - 1260",
            },
          },
          // --- KATEGORI: NUTRISI ---
          {
            id: 4,
            name: "Nutrisi AB Mix Premium",
            category: "nutrisi",
            price: 45000,
            originalPrice: 55000,
            image:
              "http://i.pinimg.com/736x/d5/0d/ad/d50dadbceb8948b3afcba70f927facdf.jpg",
            rating: 4.7,
            sold: "400+",
            date: "2024-06-15",
            badge: { text: "DISKON", class: "badge-sale" },
            description:
              "Nutrisi lengkap siap pakai untuk semua jenis tanaman hidroponik, mengandung unsur makro dan mikro esensial yang 100% larut dalam air. Cukup campurkan pekatan A dan B dengan air sesuai takaran.",
            specs: {
              Bentuk: "Pekatan Cair",
              Ukuran: "2 x 250ml",
              "Target PPM": "1000-1400 PPM",
              Kandungan: "Unsur Makro & Mikro Lengkap",
            },
          },
          {
            id: 13,
            name: "Pupuk Organik Cair (POC)",
            category: "nutrisi",
            price: 35000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/736x/20/7b/10/207b108b49d9d8410f18a2a30e29f102.jpg",
            rating: 4.5,
            sold: "1.8k",
            date: "2024-04-25",
            badge: null,
            description:
              "Pupuk organik cair yang kaya akan mikroorganisme baik untuk menyuburkan media tanam dan menyehatkan akar. Cocok untuk tanaman konvensional dan sebagai suplemen pada hidroponik.",
            specs: {
              Bentuk: "Cair",
              Ukuran: "500ml",
              Aplikasi: "Siram ke media tanam / Semprot ke daun",
              Frekuensi: "1-2 minggu sekali",
            },
          },
          {
            id: 14,
            name: "Root Booster Super",
            category: "nutrisi",
            price: 55000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/736x/58/cd/c3/58cdc3c5f5aabb37836ae1eba2e19ed0.jpg",
            rating: 4.9,
            sold: "2.2k",
            date: "2024-07-30",
            badge: { text: "BEST SELLER", class: "badge-bestseller" },
            description:
              "Formula khusus untuk merangsang pertumbuhan akar baru, membuat tanaman lebih kuat dan sehat. Sangat baik digunakan pada saat pindah tanam atau untuk perbanyakan stek.",
            specs: {
              Bentuk: "Cair",
              Ukuran: "100ml",
              "Kandungan Utama": "Hormon Auksin, Vitamin B1",
              Dosis: "2ml per liter air",
            },
          },
          {
            id: 20,
            name: "Kalsium Nitrat (KNO3)",
            category: "nutrisi",
            price: 28000,
            originalPrice: null,
            image:
              "https://images.tokopedia.net/img/cache/700/product-1/2020/7/15/6477595/6477595_2292d5e9-8f04-4697-a2c9-2e202a78087a_747_747.jpg",
            rating: 4.6,
            sold: "980",
            date: "2024-02-11",
            badge: null,
            description:
              "Pupuk makro sekunder yang penting untuk mencegah kerontokan bunga dan buah, serta memperkuat dinding sel tanaman. Wajib dimiliki untuk budidaya tanaman buah.",
            specs: {
              Bentuk: "Kristal",
              "Berat Bersih": "500 gram",
              Kelarutan: "100% larut air",
              Penggunaan: "Komponen tambahan nutrisi AB Mix",
            },
          },
          // --- KATEGORI: MEDIA TANAM ---
          {
            id: 5,
            name: "Rockwool Cultilene",
            category: "media",
            price: 15000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/93/d1/64/93d164ef5fe8afb9c5ded04b26eafb57.jpg",
            rating: 4.9,
            sold: "312",
            date: "2024-05-20",
            badge: { text: "BEST SELLER", class: "badge-bestseller" },
            description:
              "Media tanam rockwool impor berkualitas tinggi, mampu menyerap air dengan baik dan steril. Sangat ideal untuk tahap persemaian benih hidroponik.",
            specs: {
              Ukuran: "1 slab (100cm x 15cm x 7.5cm)",
              Kepadatan: "45 kg/m³",
              "Arah Serat": "Horizontal",
              Kelebihan: "Steril, retensi air tinggi",
            },
          },
          {
            id: 16,
            name: "Hydroton Jerman",
            category: "media",
            price: 35000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/1200x/5a/55/83/5a5583d434516eae605ba27783c91621.jpg",
            rating: 4.8,
            sold: "1.5k",
            date: "2024-07-05",
            badge: null,
            description:
              "Media tanam hidroponik dari tanah liat yang dibakar, bisa dipakai berulang kali dan memiliki aerasi yang sangat baik untuk akar. Ukuran seragam dan tidak mudah hancur.",
            specs: {
              "Berat Bersih": "1 Liter",
              Ukuran: "8-16 mm",
              Bahan: "Tanah Liat Pilihan",
              Kelebihan: "Dapat digunakan kembali, pH netral",
            },
          },
          {
            id: 17,
            name: "Cocopeat Blok Premium",
            category: "media",
            price: 22000,
            originalPrice: 28000,
            image:
              "https://i.pinimg.com/736x/2a/c6/5e/2ac65e07e88337e92cf7761941e444bd.jpg",
            rating: 4.7,
            sold: "3.5k",
            date: "2024-06-01",
            badge: { text: "DISKON", class: "badge-sale" },
            description:
              "Media tanam organik dari serabut kelapa yang sudah diproses dan dicuci, bebas dari zat tanin. Cukup direndam air, blok akan mengembang hingga 5-7 kali lipat.",
            specs: {
              "Berat Kering": "± 500 gram",
              "Volume Setelah Mengembang": "5-7 Liter",
              EC: "< 0.5 mS/cm",
              Kelebihan: "Daya simpan air tinggi",
            },
          },
          {
            id: 19,
            name: "Sekam Bakar Fermentasi",
            category: "media",
            price: 18000,
            originalPrice: null,
            image:
              "https://i.pinimg.com/736x/11/64/98/11649824eb0aa47fb4f5987b388f194c.jpg",
            rating: 4.6,
            sold: "2.8k",
            date: "2024-01-30",
            badge: null,
            description:
              "Media tanam porous yang sudah difermentasi, bagus untuk aerasi akar dan mencegah jamur. Sangat cocok sebagai campuran media tanam konvensional maupun untuk lapisan dasar pot hidroponik.",
            specs: {
              "Berat Bersih": "1 kg",
              "Kadar Air": "< 15%",
              pH: "Netral (6.5 - 7.0)",
              Bahan: "Sekam padi pilihan",
            },
          },
        ];
        const productListContainer = document.getElementById("product-list");
        let currentSort = "terbaru";

        // ===================================================================
        // FUNGSI UNTUK MENAMPILKAN PRODUK (TIDAK BERUBAH)
        // ===================================================================
        // Buka file: public/products.html
        // Cari dan ganti seluruh fungsi renderProducts dengan ini:

        function renderProducts(productsToRender) {
          productListContainer.innerHTML = ""; // Kosongkan dulu containernya

          // [LANGKAH 1] Ambil data wishlist dari localStorage SEBELUM me-render
          const wishlistIds =
            JSON.parse(localStorage.getItem("smartfarm_wishlist")) || [];

          if (productsToRender.length === 0) {
            productListContainer.innerHTML =
              '<p class="text-center col-12">Yah, produk yang kamu cari nggak ketemu nih :(</p>';
            return;
          }

          productsToRender.forEach((product) => {
            // [LANGKAH 2] Cek apakah produk ini ada di dalam wishlist
            const isInWishlist = wishlistIds.includes(product.id.toString());
            const heartIconClass = isInWishlist ? "fas" : "far"; // Jika ada, pakai ikon 'fas' (penuh)
            const heartStyle = isInWishlist ? 'style="color: #dc3545;"' : ""; // Jika ada, warnai merah

            // Membuat bintang rating (tidak berubah)
            let ratingStars = "";
            for (let i = 1; i <= 5; i++) {
              if (i <= product.rating)
                ratingStars += '<i class="fas fa-star"></i>';
              else if (i - 0.5 <= product.rating)
                ratingStars += '<i class="fas fa-star-half-alt"></i>';
              else ratingStars += '<i class="far fa-star"></i>';
            }

            const badgeHTML = product.badge
              ? `<div class="product-badge ${product.badge.class}">${product.badge.text}</div>`
              : "";
            const priceHTML = product.originalPrice
              ? `<span class="price-original">Rp ${product.originalPrice.toLocaleString(
                  "id-ID"
                )}</span> Rp ${product.price.toLocaleString("id-ID")}`
              : `Rp ${product.price.toLocaleString("id-ID")}`;

            // [LANGKAH 3] Terapkan class dan style yang sudah kita tentukan ke tombol wishlist
            const productCardHTML = `
            <div class="col product-item">
                <div class="product-card-offer h-100">
                    <div class="product-image-wrapper">
                        <a href="product_detail.html?id=${
                          product.id
                        }"><img src="${product.image}" alt="${
              product.name
            }"/></a>
                        ${badgeHTML}
                        <div class="product-actions">
                            <button 
                                class="action-btn" 
                                title="Tambah ke Wishlist"
                                data-product-id="${product.id}"
                                data-product-name="${product.name}"
                                ${heartStyle} 
                            >
                                <i class="${heartIconClass} fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product-info">
                        <p class="product-category">${
                          product.category.charAt(0).toUpperCase() +
                          product.category.slice(1)
                        }</p>
                        <h3 class="product-title"><a href="product_detail.html?id=${
                          product.id
                        }">${product.name}</a></h3>
                        <div class="d-flex align-items-center mb-2">
                            <div class="product-rating">${ratingStars}</div>
                            <small class="product-sold ms-2">(${
                              product.sold
                            } terjual)</small>
                        </div>
                        <div class="product-price-action mt-auto">
                            <p class="product-price">${priceHTML}</p>
                            <button 
                                class="btn-add-cart-icon" 
                                title="Tambah ke Keranjang"
                                data-product-id="${product.id}"
                                data-product-name="${product.name}"
                                data-product-price="${product.price}"
                                data-product-image="${product.image}"
                            ><i class="fas fa-shopping-cart"></i></button>
                        </div>
                    </div>
                </div>
            </div>`;
            productListContainer.innerHTML += productCardHTML;
          });
        }

        // ===================================================================
        // FUNGSI UTAMA UNTUK FILTER & SORTING (TIDAK BERUBAH)
        // ===================================================================
        const categoryFilters = document.querySelectorAll(".category-filter");
        const priceRange = document.getElementById("hargaRange");
        const priceLabel = document.getElementById("hargaLabel");
        const searchInput = document.getElementById("searchInput");
        const sortOptions = document.querySelectorAll(".sort-option");
        const sortButton = document.getElementById("sortButton");

        function applyFiltersAndSort() {
          const selectedCategories = Array.from(
            document.querySelectorAll(".category-filter:checked")
          ).map((cb) => cb.value);
          const maxPrice = parseInt(priceRange.value);
          const searchTerm = searchInput.value.toLowerCase();

          let filteredProducts = allProducts.filter((product) => {
            const categoryMatch =
              selectedCategories.length === 0 ||
              selectedCategories.includes(product.category);
            const priceMatch = product.price <= maxPrice;
            const searchMatch = product.name.toLowerCase().includes(searchTerm);
            return categoryMatch && priceMatch && searchMatch;
          });

          if (currentSort === "harga-asc") {
            filteredProducts.sort((a, b) => a.price - b.price);
          } else if (currentSort === "harga-desc") {
            filteredProducts.sort((a, b) => b.price - a.price);
          } else {
            filteredProducts.sort(
              (a, b) => new Date(b.date) - new Date(a.date)
            );
          }

          renderProducts(filteredProducts);
        }

        function updatePriceLabel() {
          const value = parseInt(priceRange.value);
          priceLabel.textContent = `Maks: Rp ${value.toLocaleString("id-ID")}`;
        }

        categoryFilters.forEach((filter) =>
          filter.addEventListener("change", applyFiltersAndSort)
        );
        priceRange.addEventListener("input", () => {
          updatePriceLabel();
          applyFiltersAndSort();
        });
        searchInput.addEventListener("input", applyFiltersAndSort);
        sortOptions.forEach((option) => {
          option.addEventListener("click", function (e) {
            e.preventDefault();
            currentSort = this.dataset.sort;
            sortButton.textContent = `Urutkan: ${this.textContent}`;
            applyFiltersAndSort();
          });
        });

        // ===================================================================
        // [INI BAGIAN BARUNYA] INISIALISASI & CEK PARAMETER URL
        // ===================================================================
        function initializePage() {
          const urlParams = new URLSearchParams(window.location.search);
          const categoryFromURL = urlParams.get("category");

          updatePriceLabel(); // Selalu update label harga

          if (categoryFromURL) {
            const categoriesToSelect = categoryFromURL.split(",");

            // Hapus semua centang dulu biar bersih
            document.querySelectorAll(".category-filter").forEach((cb) => {
              cb.checked = false;
            });

            // Centang checkbox yang sesuai dari parameter URL
            categoriesToSelect.forEach((categoryValue) => {
              const checkboxToSelect = document.querySelector(
                `.category-filter[value="${categoryValue.trim()}"]`
              );
              if (checkboxToSelect) {
                checkboxToSelect.checked = true;
              }
            });
          }

          // Terapkan filter & sort berdasarkan kondisi awal (baik ada parameter atau tidak)
          applyFiltersAndSort();
        }

        // Panggil fungsi inisialisasi untuk memulai semuanya
        initializePage();
      });
    </script>
  </body>
</html>
