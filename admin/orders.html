<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Orders</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../assets/css/admin_style.css" />

    <style>
      /* --- STYLE UNTUK ANIMASI FADE IN --- */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Terapkan animasi ke elemen utama */
      .content-header,
      .order-summary-cards .col,
      .recent-orders-section {
        opacity: 0; /* Mulai dari transparan */
        animation: fadeInUp 0.6s ease-out forwards;
      }

      /* Atur jeda (delay) agar animasi muncul berurutan */
      .content-header { animation-delay: 0.1s; }
      .order-summary-cards .col:nth-child(1) { animation-delay: 0.2s; }
      .order-summary-cards .col:nth-child(2) { animation-delay: 0.3s; }
      .order-summary-cards .col:nth-child(3) { animation-delay: 0.4s; }
      .order-summary-cards .col:nth-child(4) { animation-delay: 0.5s; }
      .order-summary-cards .col:nth-child(5) { animation-delay: 0.6s; }
      .recent-orders-section { animation-delay: 0.7s; }
      /* --- AKHIR STYLE ANIMASI --- */

      /* CSS untuk badge status */
      .status-badge-completed { background-color: #198754; color: #fff; }
      .status-badge-pending { background-color: #ffc107; color: #000; }
      .status-badge-canceled { background-color: #dc3545; color: #fff; }
      .status-badge-delivery { background-color: #6610f2; color: #fff; }

      /* Penambahan CSS untuk warna kartu summary baru */
      .bg-indigo-light { background-color: #e0cffc; }
      .bg-indigo-dark { background-color: #6610f2; }
      /* --- STYLE BARU UNTUK HOVER TOMBOL HAPUS --- */
      .delete-btn {
        background-color: #6c757d14;
        transition: background-color 0.2s ease-in-out;
      }

      .delete-btn i {
        transition: color 0.2s ease-in-out;
      }

      .delete-btn:hover {
        background-color: #6c757d14;
      }

      .delete-btn:hover i {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="admin-wrapper">
      <div id="sidebar-container"></div>
      <div id="overlay"></div>

      <div class="main-content" id="mainContent">
        <header class="content-header">
          <div class="header-welcome">
            <h2 class="mb-0">Master Orders</h2>
            <p class="text-muted">
              Welcome back, Revan! Here's your order list.
            </p>
          </div>
        </header>

        <section class="order-summary-cards mb-4">
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
            <div class="col">
              <div class="summary-card-order bg-primary-light h-100 d-flex align-items-center justify-content-center">
                <div class="icon-wrapper-order bg-primary-dark">
                  <i class="fas fa-box"></i>
                </div>
                <div class="info-wrapper-order">
                  <p class="text-nowrap">Total Orders</p>
                  <h4 id="total-orders-count">0</h4>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="summary-card-order bg-success-light h-100 d-flex align-items-center justify-content-center">
                <div class="icon-wrapper-order bg-success-dark">
                  <i class="fas fa-check-circle"></i>
                </div>
                <div class="info-wrapper-order">
                  <p class="text-nowrap">Completed</p>
                  <h4 id="completed-orders-count">0</h4>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="summary-card-order bg-warning-light h-100 d-flex align-items-center justify-content-center">
                <div class="icon-wrapper-order bg-warning-dark">
                  <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="info-wrapper-order">
                  <p class="text-nowrap">Pending</p>
                  <h4 id="pending-orders-count">0</h4>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="summary-card-order bg-indigo-light h-100 d-flex align-items-center justify-content-center">
                <div class="icon-wrapper-order bg-indigo-dark">
                  <i class="fas fa-truck"></i>
                </div>
                <div class="info-wrapper-order">
                  <p class="text-nowrap">Delivery</p>
                  <h4 id="delivery-orders-count">0</h4>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="summary-card-order bg-danger-light h-100 d-flex align-items-center justify-content-center">
                <div class="icon-wrapper-order bg-danger-dark">
                  <i class="fas fa-times-circle"></i>
                </div>
                <div class="info-wrapper-order">
                  <p class="text-nowrap">Canceled</p>
                  <h4 id="canceled-orders-count">0</h4>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="recent-orders-section">
          <div class="card dashboard-card">
            <div class="card-body">
              <div
                class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2"
              >
                <h5 class="card-title-custom mb-0">Recent Orders</h5>
                <div class="d-flex flex-wrap gap-2">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="fas fa-search"></i>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Search orders..."
                      id="searchInput"
                    />
                  </div>

                  <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="fas fa-filter me-2"></i>
                      <span id="filter-btn-text">Filter</span>
                    </button>

                    <ul class="dropdown-menu" aria-labelledby="filterDropdown">
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);" data-filter-status="all">Semua Pesanan</a>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);" data-filter-status="pending">
                          <span class="d-inline-block rounded-circle me-2" style="width: 8px; height: 8px; background-color: #ffc107;"></span>
                          Pending
                        </a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);" data-filter-status="completed">
                          <span class="d-inline-block rounded-circle me-2" style="width: 8px; height: 8px; background-color: #198754;"></span>
                          Completed
                        </a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);" data-filter-status="canceled">
                          <span class="d-inline-block rounded-circle me-2" style="width: 8px; height: 8px; background-color: #dc3545;"></span>
                          Canceled
                        </a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="javascript:void(0);" data-filter-status="delivery">
                          <span class="d-inline-block rounded-circle me-2" style="width: 8px; height: 8px; background-color: #6610f2;"></span>
                          Delivery
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="table-responsive">
                <table class="table align-middle orders-table-new">
                  <thead>
                    <tr>
                      <th>Order ID</th>
                      <th>Customer</th>
                      <th>Date</th>
                      <th>Total</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../assets/js/admin_script.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Data Awal Pesanan
        let ordersData = [
          { id: "#876364", customer: "Revan Putra", date: "07 Sep, 2025", total: "Rp 160.000", status: "Completed", href: "order/order_detailRevanPutra.html", edit_href: "confirm_orders/confirm_RevanArya.html" },
          { id: "#876365", customer: "Citra Lestari", date: "07 Sep, 2025", total: "Rp 135.000", status: "Pending", href: "order/order_detailCitraLestari.html", edit_href: "confirm_orders/confirm_CitraLestari.html" },
          { id: "#876366", customer: "Andi Budi", date: "06 Sep, 2025", total: "Rp 120.000", status: "Canceled", href: "order/order_detailAndiBudi.html", edit_href: "confirm_orders/confirm_AndiBudi.html" },
          { id: "#876367", customer: "Dewi Lestari", date: "05 Sep, 2025", total: "Rp 90.000", status: "delivery", href: "order/order_detailDewiLestari.html", edit_href: "confirm_orders/confirm_DewiLestari.html" },
          { id: "#876368", customer: "Siska Amelia", date: "05 Sep, 2025", total: "Rp 25.000", status: "Completed", href: "order/order_detailSiskaAmelia.html", edit_href: "confirm_orders/confirm_SiskaAmelia.html" },
          { id: "#876369", customer: "Arsya Aji", date: "05 Sep, 2025", total: "Rp 35.000", status: "Pending", href: "order/order_detailArsyaAji.html", edit_href: "confirm_orders/confirm_ArsyaAji.html" },
          { id: "#876370", customer: "Dewi Anggraini", date: "04 Sep, 2025", total: "Rp 150.000", status: "Completed", href: "order/order_detailDewiAnggraini.html", edit_href: "confirm_orders/confirm_DewiAnggraini.html" },
          { id: "#876371", customer: "Budi Santoso", date: "03 Sep, 2025", total: "Rp 150.000", status: "delivery", href: "order/order_detailBudiSantoso.html", edit_href: "confirm_orders/confirm_BudiSantoso.html" },
          { id: "#876372", customer: "Bagas Perkasa", date: "03 Sep, 2025", total: "Rp 120.000", status: "Canceled", href: "order/order_detailBagasPerkasa.html", edit_href: "confirm_orders/confirm_BagasPerkasa.html" },
          { id: "#876373", customer: "Rina Wijaya", date: "02 Sep, 2025", total: "Rp 150.000", status: "Completed", href: "order/order_detailRinaWijaya.html", edit_href: "confirm_orders/confirm_RinaWijaya.html" }
        ];

        const tableBody = document.getElementById('ordersTableBody');
        const filterBtnText = document.getElementById('filter-btn-text');
        const searchInput = document.getElementById('searchInput');
        let currentFilterStatus = 'all';

        const updateSummaryCards = () => {
          document.getElementById('total-orders-count').textContent = ordersData.length;
          document.getElementById('completed-orders-count').textContent = ordersData.filter(o => o.status.toLowerCase() === 'completed').length;
          document.getElementById('pending-orders-count').textContent = ordersData.filter(o => o.status.toLowerCase() === 'pending').length;
          document.getElementById('canceled-orders-count').textContent = ordersData.filter(o => o.status.toLowerCase() === 'canceled').length;
          document.getElementById('delivery-orders-count').textContent = ordersData.filter(o => o.status.toLowerCase() === 'delivery').length;
        };

        const getStatusBadge = (status) => {
          const statusClass = `status-badge-${status.toLowerCase()}`;
          return `<span class="badge rounded-pill ${statusClass}">${status}</span>`;
        };

        const renderTable = (data) => {
          tableBody.innerHTML = '';
          if (data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Tidak ada pesanan yang ditemukan.</td></tr>';
            return;
          }
          data.forEach(order => {
            const row = `
              <tr>
                <td class="fw-bold">${order.id}</td>
                <td>${order.customer}</td>
                <td>${order.date}</td>
                <td class="fw-bold">${order.total}</td>
                <td>${getStatusBadge(order.status)}</td>
                <td>
                  <a href="${order.href}" class="btn btn-icon btn-sm"><i class="fas fa-eye"></i></a>
                  <a href="${order.edit_href}" class="btn btn-icon btn-sm"><i class="fas fa-pencil-alt"></i></a>
                  <a href="#" class="btn btn-icon btn-sm delete-btn" 
                     data-order-id="${order.id}" 
                     data-order-customer="${order.customer}">
                    <i class="fas fa-trash-alt"></i>
                  </a>
                </td>
              </tr>
            `;
            tableBody.innerHTML += row;
          });
        };
        
        const applyFiltersAndSearch = () => {
          const searchText = searchInput.value.toLowerCase();
          const filteredByStatus = currentFilterStatus === 'all'
            ? ordersData
            : ordersData.filter(order => order.status.toLowerCase() === currentFilterStatus.toLowerCase());
          const finalFilteredData = filteredByStatus.filter(order => 
            order.id.toLowerCase().includes(searchText) ||
            order.customer.toLowerCase().includes(searchText)
          );
          renderTable(finalFilteredData);
        };
        
        // --- LOGIKA FUNGSI HAPUS BARU DENGAN SWEETALERT2 ---

        const deleteOrder = (orderId) => {
          const orderIndex = ordersData.findIndex(order => order.id === orderId);
          if (orderIndex > -1) {
            ordersData.splice(orderIndex, 1);
            updateSummaryCards();
            applyFiltersAndSearch();
          }
        };

        tableBody.addEventListener('click', function (event) {
          const deleteButton = event.target.closest('.delete-btn');
          if (deleteButton) {
            event.preventDefault();
            const orderId = deleteButton.dataset.orderId;
            const customerName = deleteButton.dataset.orderCustomer;
            
            Swal.fire({
                title: 'Anda yakin?',
                html: `Yakin mau hapus pesanan dari <strong>${customerName}</strong> (ID: ${orderId})?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Ya, Hapus',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteOrder(orderId);
                    
                    Swal.fire({
                        title: 'Dihapus!',
                        text: `Pesanan dari ${customerName} berhasil dihapus.`,
                        icon: 'success',
                        customClass: {
                            confirmButton: 'btn btn-primary-custom'
                        },
                        buttonsStyling: false
                    });
                }
            });
          }
        });
        
        // --- AKHIR LOGIKA FUNGSI HAPUS ---

        updateSummaryCards();
        applyFiltersAndSearch();

        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', (event) => {
                const newStatus = event.target.closest('.dropdown-item').getAttribute('data-filter-status');
                currentFilterStatus = newStatus;
                if (newStatus === 'all') {
                    filterBtnText.textContent = 'Semua Pesanan';
                } else {
                    filterBtnText.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                }
                applyFiltersAndSearch();
            });
        });

        searchInput.addEventListener('input', applyFiltersAndSearch);
      });
    </script>
  </body>
</html> 