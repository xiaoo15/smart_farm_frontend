<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Analisis Total Produk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/css/admin_style.css" />
    <style>
        .chart-container { position: relative; height: 400px; }
        .card-box { border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-radius: 12px; }
        .btn {background-color: white; color: #495077; border: 1px solid #ced4da;}
        .btn.active {background-color: #235347; border-color: #235347; color: white;}
    </style>
</head>
<body>
    <div class="admin-wrapper">
      <div id="sidebar-container"></div>
      <div class="main-content">
        <header class="content-header">
          <div>
            <h2>Analisis Total Produk</h2>
            <p>Ringkasan penjualan dan produk terlaris berdasarkan periode waktu.</p>
          </div>
        </header>

        <div class="dashboard-section">
            <div class="card card-box">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-chart-bar text-primary me-2"></i>Ringkasan Penjualan & Produk Terlaris</h5>
                    <div class="btn-group btn-group-sm" id="dynamic-product-filter">
                        <button type="button" class="btn btn-outline-secondary active" data-period="week">7 Hari</button>
                        <button type="button" class="btn btn-outline-secondary" data-period="month">30 Hari</button>
                        <button type="button" class="btn btn-outline-secondary" data-period="year">1 Tahun</button>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <h6 class="text-muted">Grafik Total Penjualan</h6>
                            <div class="chart-container">
                                <canvas id="dynamicSalesChart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <h6><i class="fas fa-trophy text-warning me-2"></i>Top 4 Produk Terlaris</h6>
                            <p class="text-muted small mt-n1">Berdasarkan periode yang dipilih.</p>
                            <ul class="list-group list-group-flush" id="dynamic-bestseller-list"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../assets/js/admin_script.js"></script>
    
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const analysisData = {
            week: {
                chartLabels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                chartData: [12, 19, 8, 15, 22, 18, 10],
                bestsellers: [
                    { name: 'Bibit Selada Romaine', sales: '87 Terjual' },
                    { name: 'HydroKit Mini Starter', sales: '55 Terjual' },
                    { name: 'Caladium Red Star', sales: '32 Terjual' },
                    { name: 'Nutrisi AB Mix', sales: '25 Terjual' }
                ]
            },
            month: {
                chartLabels: ['Minggu 1', 'Minggu 2', 'Minggu 3', 'Minggu 4'],
                chartData: [90, 110, 95, 130],
                bestsellers: [
                    { name: 'HydroKit Mini Starter', sales: '350 Terjual' },
                    { name: 'Bibit Selada Romaine', sales: '280 Terjual' },
                    { name: 'Nutrisi AB Mix', sales: '150 Terjual' },
                    { name: 'Monstera Deliciosa', sales: '125 Terjual' }
                ]
            },
            year: {
                chartLabels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                chartData: [550, 620, 580, 700, 650, 720],
                bestsellers: [
                    { name: 'HydroKit Mini Starter', sales: '3.2k Terjual' },
                    { name: 'Bibit Selada Romaine', sales: '2.5k Terjual' },
                    { name: 'Nutrisi AB Mix', sales: '1.8k Terjual' },
                    { name: 'Monstera Deliciosa', sales: '1.2k Terjual' }
                ]
            }
        };

        const chartCanvas = document.getElementById('dynamicSalesChart').getContext('2d');
        const dynamicSalesChart = new Chart(chartCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Jumlah Penjualan',
                    data: [],
                    borderColor: '#235347',
                    backgroundColor: 'rgba(35, 83, 71, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } }
            }
        });

        const bestsellerList = document.getElementById('dynamic-bestseller-list');
        const filterButtons = document.getElementById('dynamic-product-filter');

        function updateAnalysisView(period) {
            const data = analysisData[period];
            
            // Update Grafik
            dynamicSalesChart.data.labels = data.chartLabels;
            dynamicSalesChart.data.datasets[0].data = data.chartData;
            dynamicSalesChart.update();

            // Update Daftar Produk Terlaris
            bestsellerList.innerHTML = '';
            data.bestsellers.forEach((product, index) => {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `
                    <div>
                        <span class="fw-bold me-2">${index + 1}.</span>${product.name}
                    </div>
                    <span class="badge bg-primary rounded-pill">${product.sales}</span>
                `;
                bestsellerList.appendChild(li);
            });
        }

        filterButtons.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const period = e.target.dataset.period;
                filterButtons.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');
                updateAnalysisView(period);
            }
        });

        // Panggilan awal saat halaman dimuat
        updateAnalysisView('week');
    });
    </script>
</body>
<script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- FUNGSI SEARCH BAR ---
        const searchInput = document.getElementById("searchInput");
        if (searchInput) {
          searchInput.addEventListener("keyup", function (event) {
            if (event.key === "Enter") {
              const query = searchInput.value.trim();
              if (query) {
                window.location.href = `search-results.html?q=${encodeURIComponent(
                  query
                )}`;
              }
            }
          });
        }

        // --- JAVASCRIPT UNTUK MODAL CUSTOMER ---
        const customerDetailModal = document.getElementById(
          "customerDetailModal"
        );
        if (customerDetailModal) {
          customerDetailModal.addEventListener(
            "show.bs.modal",
            function (event) {
              const triggerElement = event.relatedTarget;
              const name = triggerElement.getAttribute("data-name");
              const username = triggerElement.getAttribute("data-username");
              const orders = triggerElement.getAttribute("data-orders");
              const spending = triggerElement.getAttribute("data-spending");
              const profileLink =
                triggerElement.getAttribute("data-profile-link");

              const modalName =
                customerDetailModal.querySelector("#modalCustomerName");
              const modalUsername = customerDetailModal.querySelector(
                "#modalCustomerUsername"
              );
              const modalTotalOrders =
                customerDetailModal.querySelector("#modalTotalOrders");
              const modalTotalSpending = customerDetailModal.querySelector(
                "#modalTotalSpending"
              );
              const modalProfileLink = customerDetailModal.querySelector(
                "#modalCustomerProfileLink"
              );

              modalName.textContent = name;
              modalUsername.textContent = username;
              modalTotalOrders.textContent = orders;
              modalTotalSpending.textContent = spending;
              modalProfileLink.href = profileLink;
            }
          );
        }

        // --- FUNGSI UNTUK MEMBUAT BARIS TABEL DAN ITEM PRODUK BISA DIKLIK ---
        document.querySelectorAll(".clickable-row").forEach((row) => {
          row.addEventListener("click", () => {
            window.location.href = row.dataset.href;
          });
        });

        // --- GRAFIK (CHARTS) DENGAN DATA DINAMIS ---
        const salesData = {
          week: {
            labels: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
            sales: [65, 59, 80, 81, 56, 55, 40],
            revenue: [28, 48, 40, 19, 86, 27, 90],
          },
          month: {
            labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
            sales: [350, 410, 380, 500],
            revenue: [180, 220, 190, 250],
          },
          year: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
            sales: [500, 450, 600, 700, 550, 650, 750],
            revenue: [250, 220, 300, 350, 270, 320, 370],
          },
        };
        const ordersChartData = {
          week: [1200, 345, 123],
          month: [4800, 1200, 510],
          year: [15000, 3500, 1800],
        };
        let salesChart;
        let ordersChart;
        const updateCharts = (period) => {
          if (salesChart) {
            const salesPeriodData = salesData[period];
            salesChart.data.labels = salesPeriodData.labels;
            salesChart.data.datasets[0].data = salesPeriodData.sales;
            salesChart.data.datasets[1].data = salesPeriodData.revenue;
            salesChart.update();
          }
          if (ordersChart) {
            ordersChart.data.datasets[0].data = ordersChartData[period];
            ordersChart.update();
          }
        };
        const salesChartCanvasNew = document.getElementById("salesChartNew");
        if (salesChartCanvasNew) {
          const ctxSales = salesChartCanvasNew.getContext("2d");
          salesChart = new Chart(ctxSales, {
            type: "line",
            data: {
              labels: salesData.week.labels,
              datasets: [
                {
                  label: "Sales",
                  data: salesData.week.sales,
                  fill: false,
                  borderColor: "#235347",
                  tension: 0.4,
                  pointBackgroundColor: "#235347",
                  pointRadius: 5,
                },
                {
                  label: "Revenue",
                  data: salesData.week.revenue,
                  fill: false,
                  borderColor: "#8EB69B",
                  tension: 0.4,
                  pointBackgroundColor: "#8EB69B",
                  pointRadius: 5,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: "top",
                  align: "end",
                  labels: {
                    usePointStyle: true,
                    boxWidth: 8,
                    color: "#051F20",
                  },
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: { color: "#163832" },
                  grid: { color: "#DAF1DE" },
                },
                x: { ticks: { color: "#163832" } },
              },
            },
          });
        }
        const ordersChartCanvas = document.getElementById("ordersChart");
        if (ordersChartCanvas) {
          const ctxOrders = ordersChartCanvas.getContext("2d");
          ordersChart = new Chart(ctxOrders, {
            type: "doughnut",
            data: {
              labels: ["Completed", "Pending", "Canceled"],
              datasets: [
                {
                  label: "Orders",
                  data: ordersChartData.week,
                  backgroundColor: ["#235347", "#ffc107", "#dc3545"],
                  borderColor: "#FFFFFF",
                  borderWidth: 4,
                  hoverOffset: 8,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: "75%",
              plugins: { legend: { display: false } },
            },
          });
        }
        const salesPeriodBtn = document.getElementById("salesPeriodBtn");
        const salesPeriodOptions =
          document.getElementById("salesPeriodOptions");
        if (salesPeriodOptions && salesPeriodBtn) {
          salesPeriodOptions.addEventListener("click", (event) => {
            if (event.target.tagName === "A") {
              event.preventDefault();
              const period = event.target.dataset.period;
              const periodText = event.target.textContent;
              salesPeriodBtn.textContent = periodText;
              updateCharts(period);
            }
          });
        }
      });
    </script>
</html>