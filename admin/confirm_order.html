<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Konfirmasi Pesanan</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/admin_style.css" />
  </head>
  <body>
    <div id="preloader">
    <div class="spinner"></div>
</div>
    <div class="admin-wrapper">
      <div id="sidebar-container"></div>
      <div id="overlay"></div>
      <div class="main-content" id="mainContent">
        <header class="content-header">
          <div class="header-welcome">
            <h2 class="mb-0" id="main-header">Konfirmasi Pesanan...</h2>
            <p class="text-muted" id="sub-header">
              Periksa detail dan konfirmasi pesanan...
            </p>
          </div>
        </header>
        <section class="content-section">
          <div class="card dashboard-card">
            <div class="card-body p-4">
              <div class="row">
                <div class="col-lg-7">
                  <h5 class="mb-3">Detail Pesanan</h5>
                  <div class="table-responsive">
                    <table class="table align-middle">
                      <thead>
                        <tr>
                          <th style="width: 60%">Produk</th>
                          <th class="text-center">Jumlah</th>
                          <th class="text-end">Total</th>
                        </tr>
                      </thead>
                      <tbody id="product-details"></tbody>
                    </table>
                  </div>
                  <hr class="my-4" />
                  <div class="row">
                    <div class="col-md-6">
                      <h6 class="mb-3">Alamat Pengiriman</h6>
                      <address id="shipping-address"></address>
                    </div>
                    <div class="col-md-6">
                      <h6 class="mb-3">Metode Pembayaran</h6>
                      <p id="payment-method"></p>
                    </div>
                  </div>
                </div>
                <div class="col-lg-5 bg-light p-4 rounded">
                  <h5 class="mb-3">Ringkasan Biaya</h5>
                  <ul
                    class="list-group list-group-flush"
                    id="cost-summary"
                  ></ul>
                  <hr />
                  <div class="d-grid gap-2">
                    <button id="confirm-button" class="btn btn-success btn-lg">
                      <i class="fas fa-check-circle me-2"></i>Konfirmasi &
                      Proses Pesanan
                    </button>
                    <a href="orders.html" class="btn btn-outline-danger">
                      <i class="fas fa-times-circle me-2"></i>Kembali
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <footer class="footer mt-auto py-3 footer-animated">
          <div class="container-fluid">
            <div class="row">
              <div class="col-12 text-center">
                <script>
                  document.write(new Date().getFullYear());
                </script>
                Â© Smart Farm.
                <span class="d-none d-sm-inline-block"
                  >- Design & Develop by Smart Farm.</span
                >
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../assets/js/admin_script.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get("orderId");
        const customerName = urlParams.get("customerName");
        const orderDate = urlParams.get("orderDate");
        const orderTotal = urlParams.get("orderTotal");

        if (!orderId) {
          window.location.href = "orders.html";
          return;
        }

        document.getElementById(
          "main-header"
        ).textContent = `Konfirmasi Pesanan ${orderId}`;
        document.getElementById(
          "sub-header"
        ).textContent = `Periksa detail pesanan dari ${customerName}.`;

        document.getElementById(
          "product-details"
        ).innerHTML = `<tr><td><div class="d-flex align-items-center"><img src="https://via.placeholder.com/60" class="rounded me-3" alt="Produk" /><div><h6 class="mb-0">Item Pesanan (Contoh)</h6><small class="text-muted">SKU: GEN-001</small></div></div></td><td class="text-center">1</td><td class="text-end fw-bold">${orderTotal}</td></tr>`;
        document.getElementById(
          "shipping-address"
        ).innerHTML = `<strong>${customerName}</strong><br />Alamat Lengkap...<br />Kota, Provinsi, Kodepos...<br /><i class="fas fa-phone me-2"></i>081234567890`;
        document.getElementById(
          "payment-method"
        ).innerHTML = `<i class="fas fa-credit-card me-2"></i>QRIS<br /><span class="text-muted">A/N ${customerName}</span>`;
        document.getElementById(
          "cost-summary"
        ).innerHTML = `<li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">Subtotal <span>${orderTotal}</span></li><li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0">Pengiriman <span>Rp 0</span></li><li class="list-group-item d-flex justify-content-between align-items-center bg-transparent px-0 border-top pt-3"><strong class="h5">Total</strong><strong class="h5">${orderTotal}</strong></li>`;

        const confirmButton = document.getElementById("confirm-button");
        confirmButton.addEventListener("click", function (event) {
          event.preventDefault();

          // Simpan pembaruan status ke localStorage agar halaman orders.html tahu
          localStorage.setItem("adminUpdatedOrderId", orderId);
          localStorage.setItem("adminUpdatedOrderStatus", "delivery");

          Swal.fire({
            title: "Berhasil!",
            text: `Pesanan ${orderId} telah dikonfirmasi.`,
            icon: "success",
            confirmButtonText: "OK, Lihat Struk",
          }).then((result) => {
            if (result.isConfirmed) {
              // Buat URL untuk struk dengan semua data yang diperlukan
              const strukParams = new URLSearchParams({
                orderId: orderId,
                customerName: customerName,
                orderDate: orderDate,
                orderTotal: orderTotal,
              });
              // Arahkan ke halaman struk
              window.location.href = `struk.html?${strukParams.toString()}`;
            }
          });
        });
      });
    </script>
  </body>
</html>
